# Репликация.
Запустил три ноды командами:

>mongod --dbpath /home/mongo/db1 --port 27001 --replSet RS --fork --logpath /home/mongo/db1/db1.log --pidfilepath /home/mongo/db1/db1.pid
>
>mongod --dbpath /home/mongo/db2 --port 27002 --replSet RS --fork --logpath /home/mongo/db2/db2.log --pidfilepath /home/mongo/db2/db2.pid
>
>mongod --dbpath /home/mongo/db3 --port 27003 --replSet RS --fork --logpath /home/mongo/db3/db3.log --pidfilepath /home/mongo/db3/db3.pid

Проинициализировал репликасет:

>rs.initiate({"_id" : "RS", members : [{"_id" : 0, priority : 3, host : "127.0.0.1:27001"}, {"_id" : 1, host : "127.0.0.1:27002"}, {"_id" : 2, host : "127.0.0.1:27003", arbiterOnly : true}]});

После чего добавил один документ в коллекцию users и попытался прочесть его с SECONDARY базы.
![alt text](https://github.com/kot-mechanic/mongodb_otus/blob/main/screen/11111111111111111.png)

Прочесть не удалось, т.к. база не активирована для чтения.
Активировал командой rs.secondaryOk(), после чего смог найти свой документ.

![alt text](https://github.com/kot-mechanic/mongodb_otus/blob/main/screen/222222222222222222.png)


# Шардирование.
Поднял в GCP три машины - 10.182.0.5, 10.182.0.6, 10.182.0.8.

На машине 10.182.0.5 создал репликасет с конфигурацией шарда.
>mongod --configsvr --dbpath /home/mongo/dbc1 --bind_ip_all --port 27001 --replSet RScfg --fork --logpath /home/mongo/dbc1/dbc1.log --pidfilepath /home/mongo/dbc1/dbc1.pid
>
>mongod --configsvr --dbpath /home/mongo/dbc2 --bind_ip_all --port 27002 --replSet RScfg --fork --logpath /home/mongo/dbc2/dbc2.log --pidfilepath /home/mongo/dbc2/dbc2.pid
>
>mongod --configsvr --dbpath /home/mongo/dbc3 --bind_ip_all --port 27003 --replSet RScfg --fork --logpath /home/mongo/dbc3/dbc3.log --pidfilepath /home/mongo/dbc3/dbc3.pid
>
>mongo --port 27001
>
>rs.initiate({"_id" : "RScfg", configsvr: true, members : [{"_id" : 0, priority : 3, host : "10.182.0.5:27001"},{"_id" : 1, host : "10.182.0.5:27002"},{"_id" : 2, host : "10.182.0.5:27003"}]});

На машинах 10.182.0.6 и 10.182.0.9 развернул обычные репликасеты с арбитрами.

Все инстансы монго запускал с аргументом ** --bind_ip_all **
